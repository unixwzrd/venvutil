#!/usr/bin/env bash

# Exit on error
set -e

# Get the repository root directory
repo_root=$(git rev-parse --show-toplevel)

# Change to the repository root
cd "${repo_root}" || exit 1

# Pre-commit hook to update documentation and manifest
echo "Running pre-commit hooks..."

# Source the environment
if [ -f "${repo_root}/bin/shinclude/init_env.sh" ]; then
    # shellcheck source=/dev/null
    . "${repo_root}/bin/shinclude/init_env.sh"
fi

# Run vhelp generate_markdown
echo "Generating markdown documentation..."
vhelp generate_markdown

# Run generate_manifest
echo "Generating manifest..."
"${repo_root}/bin/generate_manifest"

# Add the generated files to the commit
git add docs/shdoc/**/*.md
git add manifest.lst

echo "Pre-commit hooks completed successfully" 